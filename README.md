# PySuitcase

![Python Versions](https://img.shields.io/badge/3.6%20%7C%203.7%20%7C%203.8%20%7C%203.9%20%7C%203.10%20%7C%203.11%20%7C%203.12%20%7C%203.13-blue?logo=Python&logoColor=yellow&label=Python&labelColor=blue&color=white)

[中文文档](./README_zh.md)

**Effortlessly distribute and deploy your Python applications on Windows, just like portable software.**

PySuitcase offers a novel solution for distributing Python programs on the Windows platform. It packages your entire Python project into a self-contained folder, which includes all dependencies and an independent Python interpreter. Users can run your application directly after unzipping, without needing to install Python locally or perform any complex environment setup.

## ✨ Features

* **Truly Portable Software**: No installation, no Registry entries, no complicated configuration. Users can download, unzip, and use it immediately, just like any other portable application.
* **Conquers Packaging Challenges**: Easily package projects that include large, complex libraries such as `PyTorch`, `PyTorch Geometric`, and `PyQt5`. These libraries are often a nightmare for traditional tools like `Pyinstaller` and `Nuitka`.
* **Source Code Protection**: Provides an optional code encryption feature that compiles your `.py` files into `.pyd` binary files using `Cython`, effectively protecting your intellectual property.
* **Automated Workflow**: PySuitcase automates all the tedious steps, from downloading the embeddable Python environment and installing dependencies to compiling the launcher.
* **Flexible Customization**: Supports custom application icons, specifying domestic PyPI mirror sources to accelerate dependency downloads, and an option to delete source files after encryption.

## 📋 Usage Instructions

### Step 1: Environment Preparation

1.  **Install MSVC (Microsoft Visual C++ Build Tools)**
    * Download and run the [Visual Studio Build Tools installer](https://aka.ms/vs/17/release/vs_buildtools.exe).
    * Check the box for **"Desktop development with C++"** and proceed with the installation. This is required to compile the launcher.

2.  **Prepare an environment with the same Python version as the target**
    * It's recommended to install PySuitcase in your development environment, but this will add PySuitcase as a dependency to it.
    * You can use all features of PySuitcase in a clean Python environment that matches the target Python version and only has PySuitcase installed.
    * If the environment where you run PySuitcase has a different Python version than the target, you will not be able to use the code encryption feature.

    In your chosen environment, install PySuitcase via GitHub:

    ```bash
    pip install git+[https://github.com/metaphorme/pysuitcase.git](https://github.com/metaphorme/pysuitcase.git)
    ```

### Step 2: Launch the Dedicated Command-Line Tool

To ensure PySuitcase can find the C++ compiler (`cl.exe`), you must run it from a **Visual Studio Native Tools Command Prompt**.

* From the Start Menu, find and open **"x64 Native Tools Command Prompt for VS 2022"** (or the corresponding tool for your VS version).

* Alternatively, in a regular `cmd` or `powershell` window, run the following command to load the required environment variables:

    ```cmd
    call "C:\Program Files\Microsoft Visual Studio\2022\BuildTools\VC\Auxiliary\Build\vcvars64.bat"
    ```

    *> Note: The path above may vary depending on your Visual Studio installation location and version.*

After that, activate your virtual environment (venv or conda environment).

### Step 3: Organize Your Project Files

PySuitcase expects your project to follow a simple directory structure. Assuming your project is named `MyAwesomeApp`:

```
MyAwesomeApp/              \<-- Project root directory
└── app/                   \<-- Folder for your project's Python source code
├── app.py                 \<-- Your main program entry point
├── requirements.txt       \<-- Project dependency list
└── *.py                   \<-- Other scripts
```

* **Project Root Directory (`MyAwesomeApp/`)**: You can directly package and distribute this directory. The compiled launcher will be named `<MyAwesomeApp>.exe`.
* **Source Code Folder (`app/`)**: All `.py` files should be placed in this folder. You can specify a different name during the packaging process. Your program will be executed from this directory.
* **Main Program Entry Point (`app.py`)**: Your main script must contain a function named `run()`, which will be called by the launcher generated by PySuitcase. You can also specify a different name during packaging.
* **Dependency File (`requirements.txt`)**: List all third-party libraries, such as `torch`, `pyqt5`, etc.

#### 💡 Tip:

If you need to install and use PyTorch with GPU support, you can write your `requirements.txt` like this (using CUDA 12.8 as an example):

```
--extra-index-url https://download.pytorch.org/whl/cu128
torch
torchvision
torchaudio
# --- Add your other dependencies below this line ---
numpy
pandas
````

Additionally, you need to ensure that your users have installed the appropriate NVIDIA drivers and support this CUDA version.

### Step 4: Start PySuitcase for Packaging

PySuitcase offers two modes: **Interactive Wizard** and **Command-Line Options**.

**⚠ Before first use, be sure to back up your source code and use the interactive wizard mode.**

**⚠ The command-line options mode has no confirmation prompt. If your options indicate that source code should be deleted, it will be deleted immediately and cannot be recovered!**

#### Mode 1: Interactive Wizard Mode

In your dedicated command prompt, if you run `pysuitcase` without any arguments, it will start in interactive mode.

```bash
pysuitcase
````

The program will guide you through all the configurations, including:

  * Confirming the source code folder and main script.
  * Choosing whether to encrypt the code.
  * (If not encrypting) Specifying the target Python version and architecture.
  * Setting a PyPI mirror and a custom icon.

For example:

```
> pysuitcase
Entering interactive mode...
Enter the path to your project's root directory: D:\MyAwesomeApp            <-- Project root directory
Encrypt Python source code for protection? [y/N]: N                         <-- Encrypt code? If yes, you can choose to delete all source code in a subsequent step.
Encryption disabled. You can specify a target Python version.
Enter target Python version (Default: 3.13.5): 3.11.8                       <-- Defaults to the Python interpreter version of the current environment
Enter target architecture (Default: amd64) (amd64, win32, arm64): amd64     <-- Ensure you have the corresponding toolchain and can run programs of this architecture on the current machine
Enter the name of your source code folder (Default: app): gfn2nmr           <-- Source code folder
Enter the name of your main script (Default: app.py): gfn2nmr_gui.py        <-- Main program entry point (must be under the source folder)
Enter the name of your requirements file (Default: requirements.txt):       <-- Dependency file, defaults to being under the source folder
Do you want to use a PyPI mirror? (Recommended in some regions) [y/N]:
Enter path to a custom .ico file (or press Enter for default):              <-- Custom icon
Use windowless mode? [y/N]:                                                 <-- Use windowless mode?
```

Please note:

  * Your program will be executed from within the **source code folder** directory.
  * Windowless mode does **not** allow user input via the console (e.g., the `input` function).

Before execution, all settings will be listed for a final confirmation.

After the process is complete, you will see the following in the command-line output like this:

```
To run this again without interactive prompts, use the following command:
pysuitcase D:\MyAwesomeApp --app-folder gfn2nmr --main-script gfn2nmr_gui.py --requirements-file requirements.txt --python-version 3.11.8 --arch amd64
```

You can then execute this command directly to package your code. Please note, **the command-line options mode has no confirmation prompt. If your options indicate that source code should be deleted, it will be deleted immediately and cannot be recovered\!**

#### Mode 2: Command-Line Options Mode

For automated builds, you can provide all configurations directly via command-line arguments.

**We strongly recommend that you first complete the packaging process once using the interactive wizard mode. Then, use the command generated by the wizard as a template for modification and use in your automated workflows. This can effectively prevent unexpected behavior due to incorrect parameters.**

```bash
pysuitcase C:\path\to\MyAwesomeApp --app-folder app --main-script app.py --encrypt --icon "C:\path\to\my_icon.ico" --mirror https://pypi.tuna.tsinghua.edu.cn/simple
```

### Step 5: Distribute Your Application

Once packaging is complete, your project's root directory (`MyAwesomeApp/`) is a fully self-contained application. Just compress the entire folder and you can distribute it to your users\!

**Example of the packaged directory structure (if code encryption was used):**

```
MyAwesomeApp/
├── app/
│   ├── gfn2nmr_gui.cp311-win_amd64.pyd  <-- Encrypted main script
│   ├── model.cp311-win_amd64.pyd        <-- Encrypted module
│   └── requirements.txt                 <-- Dependency file, can be deleted
├── python-<version>-embed-amd64/        <-- Embeddable Python environment
│   ├── python.exe
│   ├── Lib/
│   │   └── site-packages/               <-- All dependency libraries
│   └── ...
└── MyAwesomeApp.exe                     <-- Main application launcher
```

-----

## 🙏 Acknowledgements

The development of this project was made possible by the support of the following open-source project:

  * [**jtmoon79/PythonEmbed4Win**](https://github.com/jtmoon79/PythonEmbed4Win): Provided the core scripts for downloading and managing the embeddable Python environment, which greatly simplified the process.

## 🚀 Projects Using This Project

  * [**GFN2NMR**](https://github.com/Wen-Xuan-Wang/GFN2NMR): A scientific software for calculating C13 NMR chemical shifts.
      * Download Links: [English Version](https://oss.diazepam.cc/gfn2nmr/gfn2nmr_latest_setup.exe) | [Chinese Version](https://oss.diazepam.cc/gfn2nmr/gfn2nmr_zh_latest_setup.exe) 

## 🧑‍💻 Developers

  * **刘翯齐 (Heqi Liu)** - [GitHub @metaphorme](https://github.com/metaphorme/)
  * **高利明 (Liming Gao)** - [GitHub @nanyeglm](https://github.com/nanyeglm/)
