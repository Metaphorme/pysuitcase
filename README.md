# PySuitcase

**åœ¨ Windows å¹³å°ï¼Œåƒåˆ†å‘ç»¿è‰²è½¯ä»¶ä¸€æ ·è½»æ¾åˆ†å‘å’Œéƒ¨ç½²æ‚¨çš„ Python åº”ç”¨ç¨‹åºã€‚**

PySuitcase æä¾›äº†ä¸€ç§å…¨æ–°çš„ Python ç¨‹åºåˆ†å‘æ¨¡å¼ï¼Œä¸“ä¸º Windows å¹³å°è®¾è®¡ã€‚å®ƒèƒ½å¤Ÿå°†æ‚¨çš„ Python é¡¹ç›®æ‰“åŒ…æˆä¸€ä¸ªç‹¬ç«‹çš„æ–‡ä»¶å¤¹ï¼Œå†…éƒ¨åŒ…å«æ‰€æœ‰ä¾èµ–å’ŒåµŒå…¥å¼çš„ Python è§£é‡Šå™¨ï¼Œç”¨æˆ·æ— éœ€åœ¨æœ¬åœ°å®‰è£… Python æˆ–è¿›è¡Œä»»ä½•å¤æ‚çš„ç¯å¢ƒé…ç½®å³å¯ç›´æ¥è¿è¡Œã€‚

## âœ¨ é¡¹ç›®ç‰¹è‰²

* **çœŸæ­£çš„â€œç»¿è‰²è½¯ä»¶â€**ï¼šæ— éœ€å®‰è£…ï¼Œä¸å†™å…¥æ³¨å†Œè¡¨ï¼Œæ²¡æœ‰å¤æ‚çš„é…ç½®ã€‚ç”¨æˆ·ä¸‹è½½è§£å‹åå³å¯ç«‹å³ä½¿ç”¨ï¼Œå°±åƒä½¿ç”¨ä»»ä½•ä¾¿æºå¼åº”ç”¨ä¸€æ ·ã€‚
* **æ”»å…‹æ‰“åŒ…éš¾é¢˜**ï¼šè½»æ¾å°è£…åŒ…å« `PyTorch`ã€`PyTorch Geometric`ã€`PyQt5` ç­‰å¤§å‹å¤æ‚åº“çš„é¡¹ç›®ã€‚è¿™äº›åº“é€šå¸¸æ˜¯ `Pyinstaller`ã€`Nuitka` ç­‰ä¼ ç»Ÿå·¥å…·çš„â€œå™©æ¢¦â€ã€‚
* **æºä»£ç ä¿æŠ¤**ï¼šæä¾›å¯é€‰çš„ä»£ç åŠ å¯†åŠŸèƒ½ï¼Œä½¿ç”¨ `Cython` å°†æ‚¨çš„ `.py` æ–‡ä»¶ç¼–è¯‘æˆ `.pyd` äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œæœ‰æ•ˆä¿æŠ¤æ‚¨çš„çŸ¥è¯†äº§æƒã€‚
* **è‡ªåŠ¨åŒ–æµç¨‹**ï¼šä»ä¸‹è½½åµŒå…¥å¼ Pythonã€å®‰è£…ä¾èµ–ã€åˆ°ç¼–è¯‘å¯åŠ¨å™¨ï¼Œæ‰€æœ‰ç¹ççš„æ­¥éª¤éƒ½ç”± PySuitcase è‡ªåŠ¨åŒ–å®Œæˆã€‚
* **çµæ´»è‡ªå®šä¹‰**ï¼šæ”¯æŒè‡ªå®šä¹‰åº”ç”¨ç¨‹åºå›¾æ ‡ã€æŒ‡å®šå›½å†… PyPI é•œåƒæºä»¥åŠ é€Ÿä¾èµ–ä¸‹è½½ï¼Œå¹¶å¯é€‰æ‹©æ˜¯å¦åœ¨åŠ å¯†ååˆ é™¤æºæ–‡ä»¶ã€‚

## ğŸ“‹ ä½¿ç”¨è¯´æ˜

### ç¬¬ 1 æ­¥ï¼šç¯å¢ƒå‡†å¤‡

1.  **å®‰è£… MSVC (Microsoft Visual C++ Build Tools)**
    * ä¸‹è½½å¹¶è¿è¡Œ [Visual Studio Build Tools å®‰è£…ç¨‹åº](https://aka.ms/vs/17/release/vs_buildtools.exe)ã€‚
    * å‹¾é€‰ **â€œä½¿ç”¨ C++ çš„æ¡Œé¢å¼€å‘â€**ï¼Œç„¶åè¿›è¡Œå®‰è£…ã€‚è¿™æ˜¯ç¼–è¯‘å¯åŠ¨å™¨æ‰€å¿…éœ€çš„ã€‚

2.  **å‡†å¤‡ä¸€ä¸ªå’Œç›®æ ‡ Python ç‰ˆæœ¬ä¸€è‡´çš„ç¯å¢ƒ**
    * å»ºè®®ä½¿ç”¨æ‚¨çš„å¼€å‘ç¯å¢ƒå®‰è£… PySuitcaseï¼Œä½†è¿™æ ·ä¼šåœ¨æ‚¨çš„å¼€å‘ç¯å¢ƒä¸­å¼•å…¥ PySuitcaseï¼›
    * æ‚¨å¯ä»¥åœ¨ä¸€ä¸ªå…¨æ–°ã€å’Œç›®æ ‡ Python ç‰ˆæœ¬ä¸€è‡´ã€ä»…å®‰è£… PySuitcase çš„ Python ç¯å¢ƒä¸­ä½¿ç”¨ PySuitcase çš„å…¨éƒ¨åŠŸèƒ½ï¼›
    * å¦‚æœæ‚¨è¿è¡Œ PySuitcase çš„ç¯å¢ƒä¸ç›®æ ‡ Python ç‰ˆæœ¬ä¸ä¸€è‡´ï¼Œåˆ™æ— æ³•ä½¿ç”¨ä»£ç åŠ å¯†çš„åŠŸèƒ½ã€‚
    
    åœ¨æ‚¨é€‰å®šçš„ç¯å¢ƒä¸­ï¼Œé€šè¿‡ GitHub å®‰è£… PySuitcaseï¼š
    ```bash
    pip install git+https://github.com/metaphorme/pysuitcase.git
    ```

### ç¬¬ 2 æ­¥ï¼šå¯åŠ¨ä¸“ç”¨å‘½ä»¤è¡Œå·¥å…·

ä¸ºäº†è®© PySuitcase èƒ½å¤Ÿæ‰¾åˆ° C++ ç¼–è¯‘å™¨ (`cl.exe`)ï¼Œæ‚¨å¿…é¡»ä» **Visual Studio ä¸“ç”¨å‘½ä»¤è¡Œæç¤ºç¬¦** è¿è¡Œå®ƒã€‚

* ä»â€œå¼€å§‹â€èœå•ä¸­æ‰¾åˆ°å¹¶æ‰“å¼€ **"x64 Native Tools Command Prompt for VS 2022"** (æˆ–æ‚¨å®‰è£…çš„ VS ç‰ˆæœ¬å¯¹åº”çš„å·¥å…·)ã€‚

* æˆ–è€…ï¼Œåœ¨å¸¸è§„çš„ `cmd` æˆ– `powershell` çª—å£ä¸­ï¼Œè¿è¡Œä»¥ä¸‹å‘½ä»¤æ¥åŠ è½½æ‰€éœ€çš„ç¯å¢ƒå˜é‡ï¼š
    ```cmd
    call "C:\Program Files\Microsoft Visual Studio\2022\BuildTools\VC\Auxiliary\Build\vcvars64.bat"
    ```
    *> æ³¨æ„ï¼šä¸Šè¿°è·¯å¾„å¯èƒ½å› æ‚¨çš„ Visual Studio å®‰è£…ä½ç½®å’Œç‰ˆæœ¬è€Œå¼‚ã€‚*

ä¹‹åï¼Œæ¿€æ´»æ‚¨çš„è™šæ‹Ÿç¯å¢ƒï¼ˆvenv æˆ– conda environmentï¼‰ã€‚

### ç¬¬ 3 æ­¥ï¼šç»„ç»‡æ‚¨çš„é¡¹ç›®æ–‡ä»¶

PySuitcase æœŸæœ›æ‚¨çš„é¡¹ç›®éµå¾ªä¸€ä¸ªç®€å•çš„ç›®å½•ç»“æ„ã€‚å‡è®¾æ‚¨çš„é¡¹ç›®åä¸º `MyAwesomeApp`ï¼š

```
MyAwesomeApp/              \<-- é¡¹ç›®æ ¹ç›®å½•
â””â”€â”€ app/                   \<-- å­˜æ”¾é¡¹ç›® Python æºä»£ç çš„æ–‡ä»¶å¤¹
    â”œâ”€â”€ app.py             \<-- æ‚¨çš„ä¸»ç¨‹åºå…¥å£
    â”œâ”€â”€ requirements.txt   \<-- é¡¹ç›®ä¾èµ–åˆ—è¡¨
    â””â”€â”€ *.py               \<-- å…¶ä»–è„šæœ¬
```

* **é¡¹ç›®æ ¹ç›®å½• (`MyAwesomeApp/`)**ï¼šåœ¨å‘è¡Œæ—¶ï¼Œæ‚¨å¯ä»¥ç›´æ¥å°†æ­¤ç›®å½•æ‰“åŒ…å‘è¡Œã€‚ç¼–è¯‘å‡ºçš„å¯åŠ¨å™¨åç§°å°†ä¸º `<MyAwesomeApp>.exe`ã€‚
* **æºä»£ç æ–‡ä»¶å¤¹ (`app/`)**ï¼šæ‰€æœ‰ `.py` æ–‡ä»¶éƒ½åº”æ”¾åœ¨è¿™ä¸ªæ–‡ä»¶å¤¹å†…ã€‚æ‚¨ä¹Ÿå¯ä»¥åœ¨æ‰“åŒ…è¿‡ç¨‹ä¸­æŒ‡å®šå…¶ä»–åç§°ã€‚
* **ä¸»ç¨‹åºå…¥å£ (`app.py`)**ï¼šæ‚¨çš„ä¸»è„šæœ¬å¿…é¡»åŒ…å«ä¸€ä¸ªåä¸º `run()` çš„å‡½æ•°ï¼ŒPySuitcase ç”Ÿæˆçš„å¯åŠ¨å™¨å°†ä¼šè°ƒç”¨å®ƒã€‚æ‚¨ä¹Ÿå¯ä»¥åœ¨æ‰“åŒ…è¿‡ç¨‹ä¸­æŒ‡å®šå…¶ä»–åç§°ã€‚
* **ä¾èµ–æ–‡ä»¶ (`requirements.txt`)**ï¼šåˆ—å‡ºæ‰€æœ‰ç¬¬ä¸‰æ–¹åº“ï¼Œä¾‹å¦‚ `torch`ã€`pyqt5` ç­‰ã€‚

#### ğŸ’¡ æç¤º ï¼š

å¦‚æœæ‚¨éœ€è¦å®‰è£…å’Œä½¿ç”¨å¸¦ GPU æ”¯æŒçš„ PyTorchï¼Œå¯ä»¥åœ¨ `requirements.txt` ä¸­è¿™æ ·å†™ï¼ˆä»¥ CUDA 12.8 ä¸ºä¾‹ï¼‰ï¼š

```
--extra-index-url https://download.pytorch.org/whl/cu128
torch
torchvision
torchaudio
numpyï¼ˆæ‚¨çš„å…¶ä»–ä¾èµ–...ï¼‰
pandasï¼ˆæ‚¨çš„å…¶ä»–ä¾èµ–...ï¼‰
```

### ç¬¬ 4 æ­¥ï¼šå¯åŠ¨ PySuitcase è¿›è¡Œæ‰“åŒ…

PySuitcase æä¾›äº†ä¸¤ç§æ¨¡å¼ï¼š**äº¤äº’å¼å‘å¯¼**å’Œ**å‘½ä»¤è¡Œé€‰é¡¹**ã€‚

**âš  é¦–æ¬¡ä½¿ç”¨å‰åŠ¡å¿…å¤‡ä»½æºä»£ç ï¼Œå¹¶ä½¿ç”¨äº¤äº’å¼å‘å¯¼æ¨¡å¼ã€‚**

**âš  å‘½ä»¤è¡Œé€‰é¡¹æ¨¡å¼æ— äºŒæ¬¡ç¡®è®¤ï¼Œå¦‚æœæ‚¨çš„é€‰é¡¹è¡¨æ˜äº†ä¼šåˆ é™¤æºä»£ç ï¼Œå°†ä¼šç›´æ¥åˆ é™¤æºä»£ç ï¼Œä¸”æ— æ³•æ¢å¤ï¼**

#### æ¨¡å¼ä¸€ï¼šäº¤äº’å¼å‘å¯¼æ¨¡å¼

åœ¨æ‚¨çš„ä¸“ç”¨å‘½ä»¤è¡Œä¸­ï¼Œå¦‚æœæ‚¨ä¸å¸¦ä»»ä½•å‚æ•°ç›´æ¥è¿è¡Œ `pysuitcase`ï¼Œå®ƒä¼šå¯åŠ¨äº¤äº’æ¨¡å¼ã€‚

```bash
pysuitcase
````

ç¨‹åºå°†å¼•å¯¼æ‚¨å®Œæˆæ‰€æœ‰é…ç½®ï¼ŒåŒ…æ‹¬ï¼š

  * ç¡®è®¤æºä»£ç æ–‡ä»¶å¤¹å’Œä¸»è„šæœ¬ã€‚
  * é€‰æ‹©æ˜¯å¦åŠ å¯†ä»£ç ã€‚
  * (è‹¥ä¸åŠ å¯†) æŒ‡å®šç›®æ ‡ Python ç‰ˆæœ¬å’Œæ¶æ„ã€‚
  * è®¾ç½® PyPI é•œåƒå’Œè‡ªå®šä¹‰å›¾æ ‡ã€‚

ä¾‹å¦‚ï¼š

```
> pysuitcase
Entering interactive mode...
Enter the path to your project's root directory: D:\MyAwesomeApp         \<-- é¡¹ç›®æ ¹ç›®å½•
Encrypt Python source code for protection? [y/N]: N                      \<-- æ˜¯å¦è¿›è¡Œä»£ç åŠ å¯†ï¼Œå¦‚æœé€‰æ‹©è¿›è¡Œä»£ç åŠ å¯†ï¼Œåˆ™å¯ä»¥é€‰æ‹©åˆ é™¤æ‰€æœ‰æºä»£ç 
Encryption disabled. You can specify a target Python version.
Enter target Python version (Default: 3.13.5): 3.11.8                    \<-- é»˜è®¤ä¸ºå½“å‰ç¯å¢ƒçš„ Python è§£é‡Šå™¨ç‰ˆæœ¬
Enter target architecture (Default: amd64) (amd64, win32, arm64): amd64  \<-- è¯·ç¡®ä¿æ‚¨æœ‰ç›¸åº”çš„å·¥å…·é“¾ï¼Œå¹¶å¯åœ¨å½“å‰æœºå™¨ä¸Šè¿è¡Œæ­¤æ¶æ„çš„ç¨‹åº
Enter the name of your source code folder (Default: app): gfn2nmr        \<-- æºä»£ç æ–‡ä»¶å¤¹
Enter the name of your main script (Default: app.py): gfn2nmr_gui.py     \<-- ä¸»ç¨‹åºå…¥å£ï¼ˆæ­¤æ–‡ä»¶å¿…é¡»åœ¨æºä»£ç æ–‡ä»¶å¤¹ä¸‹ï¼‰
Enter the name of your requirements file (Default: requirements.txt):    \<-- ä¾èµ–æ–‡ä»¶ï¼Œé»˜è®¤åœ¨æºä»£ç æ–‡ä»¶å¤¹ä¸‹
Do you want to use a PyPI mirror? (Recommended in some regions) [y/N]:
Enter path to a custom .ico file (or press Enter for default):           \<-- è‡ªå®šä¹‰å›¾æ ‡
Use windowless mode? [y/N]:                                              \<-- æ˜¯å¦ä½¿ç”¨æ— çª—å£æ¨¡å¼
```

åœ¨æ­£å¼æ‰§è¡Œå‰ï¼Œå°†åˆ—å‡ºæ‰€æœ‰çš„è®¾ç½®é€‰é¡¹å¹¶è¿›è¡ŒäºŒæ¬¡ç¡®è®¤ã€‚

æ‰€æœ‰æµç¨‹å®Œæˆåï¼Œæ‚¨å¯ä»¥åœ¨å‘½ä»¤è¡Œè¾“å‡ºä¸­çœ‹åˆ°ï¼š

```
To run this again without interactive prompts, use the following command:
pysuitcase D:\MyAwesomeApp --app-folder gfn2nmr --main-script gfn2nmr_gui.py --requirements-file requirements.txt --python-version 3.11.8 --arch amd64
```

ä¹‹åï¼Œæ‚¨å¯ä»¥ç›´æ¥æ‰§è¡Œæ­¤å‘½ä»¤æ‰§è¡Œä»£ç æ‰“åŒ…ã€‚è¯·æ³¨æ„ï¼Œ**å‘½ä»¤è¡Œé€‰é¡¹æ¨¡å¼æ— äºŒæ¬¡ç¡®è®¤ï¼Œå¦‚æœæ‚¨çš„é€‰é¡¹è¡¨æ˜äº†ä¼šåˆ é™¤æºä»£ç ï¼Œå°†ä¼šç›´æ¥åˆ é™¤æºä»£ç ï¼Œä¸”æ— æ³•æ¢å¤ï¼**


#### æ¨¡å¼äºŒï¼šå‘½ä»¤è¡Œé€‰é¡¹æ¨¡å¼

å¯¹äºè‡ªåŠ¨åŒ–æ„å»ºï¼Œæ‚¨å¯ä»¥ä½¿ç”¨å‘½ä»¤è¡Œå‚æ•°ç›´æ¥æä¾›æ‰€æœ‰é…ç½®ã€‚**æ‚¨ä¸åº”åœ¨é¦–æ¬¡ä½¿ç”¨æ—¶ç›´æ¥ä½¿ç”¨å‘½ä»¤è¡Œé€‰é¡¹æ¨¡å¼ï¼æ‚¨åº”å½“é¦–å…ˆä½¿ç”¨äº¤äº’å¼å‘å¯¼æ¨¡å¼ï¼Œä½¿ç”¨å…¶è¾“å‡ºçš„å‘½ä»¤ï¼Œåœ¨è‡ªåŠ¨åŒ–å·¥ä½œæµç¨‹ä¸­ä½¿ç”¨ã€‚**

```bash
pysuitcase C:\path\to\MyAwesomeApp --app-folder app --main-script app.py --encrypt --icon "C:\path\to\my_icon.ico" --mirror https://pypi.tuna.tsinghua.edu.cn/simple
```

### ç¬¬ 5 æ­¥ï¼šåˆ†å‘æ‚¨çš„åº”ç”¨

æ‰“åŒ…å®Œæˆåï¼Œæ‚¨çš„é¡¹ç›®æ ¹ç›®å½• (`MyAwesomeApp/`) å°±æ˜¯ä¸€ä¸ªå¯ä»¥ç‹¬ç«‹è¿è¡Œçš„å®Œæ•´åº”ç”¨ã€‚å°†æ•´ä¸ªæ–‡ä»¶å¤¹å‹ç¼©ï¼Œå°±å¯ä»¥åˆ†å‘ç»™æ‚¨çš„ç”¨æˆ·äº†ï¼

è¯·æ³¨æ„ï¼Œæ‚¨çš„ç¨‹åºå°†åœ¨**æºä»£ç æ–‡ä»¶å¤¹**ç›®å½•ä¸‹æ‰§è¡Œã€‚

**æ‰“åŒ…åçš„ç›®å½•ç»“æ„ç¤ºä¾‹ï¼šï¼ˆå¦‚æœä½¿ç”¨äº†ä»£ç åŠ å¯†ï¼‰**

```
MyAwesomeApp/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ gfn2nmr_gui.cp311-win_amd64.pyd  <-- å·²åŠ å¯†çš„ä¸»è„šæœ¬
â”‚   â”œâ”€â”€ model.cp311-win_amd64.pyd        <-- å·²åŠ å¯†çš„æ¨¡å—
â”‚   â””â”€â”€ requirements.txt                 <-- ä¾èµ–æ–‡ä»¶ï¼Œå¯ä»¥åˆ é™¤
â”œâ”€â”€ python-<verison>-embed-amd64/        <-- åµŒå…¥å¼ Python ç¯å¢ƒ
â”‚   â”œâ”€â”€ python.exe
â”‚   â”œâ”€â”€ Lib/
â”‚   â”‚   â””â”€â”€ site-packages/               <-- æ‰€æœ‰ä¾èµ–åº“
â”‚   â””â”€â”€ ...
â””â”€â”€ MyAwesomeApp.exe                     <-- ä¸»ç¨‹åºå¯åŠ¨å™¨
```

-----

## ğŸ™ é¸£è°¢

æœ¬é¡¹ç›®çš„å‘å±•ç¦»ä¸å¼€ä»¥ä¸‹å¼€æºé¡¹ç›®çš„æ”¯æŒï¼š

  * [**jtmoon79/PythonEmbed4Win**](https://github.com/jtmoon79/PythonEmbed4Win)ï¼šä¸ºæœ¬é¡¹ç›®æä¾›äº†ä¸‹è½½å’Œç®¡ç†åµŒå…¥å¼ Python ç¯å¢ƒçš„æ ¸å¿ƒè„šæœ¬ï¼Œæå¤§åœ°ç®€åŒ–äº†æµç¨‹ã€‚

## ğŸš€ ä½¿ç”¨æœ¬é¡¹ç›®çš„é¡¹ç›®

  * [**GFN2NMR**](https://github.com/Wen-Xuan-Wang/GFN2NMR): ä¸€æ¬¾ç”¨äºè®¡ç®— C13 NMR åŒ–å­¦ä½ç§»çš„ç§‘å­¦è½¯ä»¶ã€‚
      * ä¸‹è½½é“¾æ¥: [ä¸­æ–‡ç‰ˆ](https://oss.diazepam.cc/gfn2nmr/gfn2nmr_zh_latest_setup.exe) | [è‹±æ–‡ç‰ˆ](https://oss.diazepam.cc/gfn2nmr/gfn2nmr_latest_setup.exe)

## ğŸ§‘â€ğŸ’» å¼€å‘äººå‘˜

  * **åˆ˜ç¿¯é½ (Heqi Liu)** - [GitHub @metaphorme](https://github.com/metaphorme/)
  * **é«˜åˆ©æ˜ (Liming Gao)** - [GitHub @nanyeglm](https://github.com/nanyeglm/)
